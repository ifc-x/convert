(function(f,c){typeof exports=="object"&&typeof module<"u"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(f=typeof globalThis<"u"?globalThis:f||self,c(f.IFCxConvert={}))})(this,(function(f){"use strict";var c=typeof document<"u"?document.currentScript:null;class k{constructor(){this.readers=[],this.writers=[]}async addReader(e){this.readers.push(e)}async addWriter(e){this.writers.push(e)}findReader(e,r){return this.readers.filter(s=>s.environments.includes(e)&&s.formats.includes(r)).sort((s,t)=>t.priority-s.priority)[0]}findWriter(e,r="sqlite"){return this.writers.filter(s=>s.environments.includes(e)&&s.formats.includes(r)).sort((s,t)=>t.priority-s.priority)[0]}findCompatiblePair(e,r,i="sqlite"){const s=this.readers.filter(o=>o.environments.includes(e)&&o.formats.includes(r)),t=this.writers.filter(o=>o.environments.includes(e)&&o.formats.includes(i));for(const o of s.sort((d,a)=>a.priority-d.priority))for(const d of t.sort((a,u)=>u.priority-a.priority)){const a=(o.outputs||[]).find(u=>(d.inputs||[]).includes(u));if(a)return{ReaderClass:o,WriterClass:d,dataType:a}}return null}}const l=new k,U=typeof process<"u"&&process?.versions?.node?"node":"browser";class g{constructor({env:e,readerClass:r,writerClass:i}={}){this.env=e||U,this.forcedReader=r,this.forcedWriter=i,this.middleware=[]}use(e){return this.middleware.push(e),this}getReader(e){if(this.forcedReader)return new this.forcedReader;const r=l.findReader(this.env,e);if(!r)throw new Error(`No reader registered for type=${e} env=${this.env}`);return new r}getWriter(e){if(this.forcedWriter)return new this.forcedWriter;const r=l.findWriter(this.env,e);if(!r)throw new Error(`No writer registered for type=${e} env=${this.env}`);return new r}initProgress(){this.progress=null,this.progressCallback=null}emitProgress(e){var r=this.progress;this.progress=Math.round(e*100),r!==this.progress&&this.progressCallback&&this.progressCallback(this.progress)}async convert(e,{inputType:r,outputType:i,progressCallback:s}={}){const t=r,o=i;this.progressCallback=s;const d=l.findCompatiblePair(this.env,t,o);if(!d)throw new Error(`No compatible reader/writer for ${t} → ${o}`);const{ReaderClass:a,WriterClass:u,dataType:p}=d,v=new a,R=new u;let h=v.emitsProgress(p)?.5:0,y=R.emitsProgress(p)?.5:0;!h&&y?y=1:h&&!y&&(h=1);let m=await v.read(e,{type:p,progressCallback:w=>this.emitProgress(w*h)});for(const w of this.middleware)m=await w(m);return R.write(m,{type:p,progressCallback:w=>this.emitProgress(h+w*y)})}}async function I(n){if(n instanceof Uint8Array)return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(typeof n=="string"){const r=await(await fetch(n)).arrayBuffer();return new Uint8Array(r)}if(typeof File<"u"&&n instanceof File||typeof Blob<"u"&&n instanceof Blob){const e=await n.arrayBuffer();return new Uint8Array(e)}throw new Error("Cannot convert input to Uint8Array")}function P(n){if(typeof n=="string"&&n.includes("."))return n.split(".").pop().toLowerCase();if(typeof File<"u"&&n instanceof File||typeof Blob<"u"&&n instanceof Blob&&n.name)return n.name.split(".").pop().toLowerCase();throw new Error("Unable to detect type — pass { type } explicitly")}async function W(n,e={}){const{middleware:r=[],readerClass:i,writerClass:s,env:t,outputType:o,progressCallback:d}=e;let{inputType:a}=e;a||=P(n);const u=new g({env:t,readerClass:i,writerClass:s});return r.forEach(p=>u.use(p)),u.convert(await I(n),{inputType:a,outputType:o,progressCallback:d})}class C{static formats=[];static environments=[];static priority=0;async read(e,r={}){throw new Error("read() not implemented")}emitsProgress(e){return!0}}class q extends C{static formats=["ifc"];static environments=["browser"];static priority=10;static outputs=["tabular","ifc"];constructor(){super(),this.worker=new Worker(new URL("/assets/ifc-reader-worker-CBq1GLnT.js",typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:c&&c.tagName.toUpperCase()==="SCRIPT"&&c.src||new URL("index.umd.js",document.baseURI).href),{type:"module"}),this.requestId=0,this.pending=new Map,this.worker.onmessage=e=>{const{id:r,result:i=null,error:s=null,progress:t=null}=e.data,{resolve:o,reject:d,progressCallback:a}=this.pending.get(r);if(t!==null){a(t);return}this.pending.delete(r),s?d(new Error(s)):o(i)}}read(e,{type:r,progressCallback:i}={}){return r=="ifc"?e:(i||=()=>{},new Promise(async(s,t)=>{try{const o=this.requestId++;this.pending.set(o,{resolve:s,reject:t,progressCallback:i}),this.worker.postMessage({id:o,buffer:e.buffer},[e.buffer])}catch(o){t(o)}}))}}class T extends C{static formats=["frag"];static environments=["browser"];static priority=10;static outputs=["tabular"];constructor(){super(),this.worker=new Worker(new URL("/assets/frag-reader-worker-C2fC1HWE.js",typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:c&&c.tagName.toUpperCase()==="SCRIPT"&&c.src||new URL("index.umd.js",document.baseURI).href),{type:"module"}),this.requestId=0,this.pending=new Map,this.worker.onmessage=e=>{const{id:r,result:i=null,error:s=null,progress:t=null}=e.data,{resolve:o,reject:d,progressCallback:a}=this.pending.get(r);if(t!==null){a(t);return}this.pending.delete(r),s?d(new Error(s)):o(i)}}read(e,{progressCallback:r}={}){return r||=()=>{},new Promise(async(i,s)=>{try{const t=this.requestId++;this.pending.set(t,{resolve:i,reject:s,progressCallback:r}),this.worker.postMessage({id:t,buffer:e.buffer},[e.buffer])}catch(t){s(t)}})}}class b{static formats=[];static environments=[];static priority=0;async write(e,r={}){throw new Error("write() not implemented")}emitsProgress(e){return!0}}class E extends b{static formats=["frag"];static environments=["browser"];static priority=10;static inputs=["ifc"];constructor(){super(),this.worker=new Worker(new URL("/assets/frag-writer-worker-CnwZw0CF.js",typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:c&&c.tagName.toUpperCase()==="SCRIPT"&&c.src||new URL("index.umd.js",document.baseURI).href),{type:"module"}),this.requestId=0,this.pending=new Map,this.worker.onmessage=e=>{const{id:r,result:i=null,error:s=null,progress:t=null}=e.data,{resolve:o,reject:d,progressCallback:a}=this.pending.get(r);if(t!==null){a(t);return}this.pending.delete(r),s?d(new Error(s)):o(i)}}write(e,{progressCallback:r}={}){return r||=()=>{},new Promise(async(i,s)=>{try{const t=this.requestId++;this.pending.set(t,{resolve:i,reject:s,progressCallback:r}),this.worker.postMessage({id:t,input:e})}catch(t){s(t)}})}}class L extends b{static formats=["db","db3","sqlite","sqlite3"];static environments=["browser"];static priority=10;static inputs=["tabular"];constructor(){super(),this.worker=new Worker(new URL("/assets/sqlite-writer-worker-8YJZ-0Mh.js",typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:c&&c.tagName.toUpperCase()==="SCRIPT"&&c.src||new URL("index.umd.js",document.baseURI).href),{type:"module"}),this.requestId=0,this.pending=new Map,this.worker.onmessage=e=>{const{id:r,result:i=null,error:s=null,progress:t=null}=e.data,{resolve:o,reject:d,progressCallback:a}=this.pending.get(r);if(t!==null){a(t);return}this.pending.delete(r),s?d(new Error(s)):o(i)}}write(e,{progressCallback:r}={}){return r||=()=>{},new Promise(async(i,s)=>{try{const t=this.requestId++;this.pending.set(t,{resolve:i,reject:s,progressCallback:r}),this.worker.postMessage({id:t,input:e})}catch(t){s(t)}})}}l.addReader(q),l.addReader(T),l.addWriter(E),l.addWriter(L),f.Converter=g,f.convert=W,f.registry=l,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})}));window.IFCx||={};window.IFCx.convert=IFCxConvert.convert;
